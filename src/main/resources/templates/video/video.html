<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://dayoon07.github.io/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/css/custom.css">
    <title th:text="${videoInfo.getVideoTitle() + ' | FlipFlop'}">FlipFlop</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
</head>
<body class="bg-black text-white overflow-hidden">

    <div th:replace="~{fragments/app-bar.html :: app-bar}"></div>

<div class="flex h-screen">
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
    <div th:replace="~{fragments/sidebar.html :: sidebar}"></div>

    <!-- Î©îÏù∏ ÏòÅÏÉÅ ÏãúÏ≤≠ ÌôîÎ©¥ -->
    <main class="flex-1 flex items-center justify-center overflow-hidden relative">
        <div class="relative w-full h-full flex items-center justify-center">
            <!-- 9:16 ÎπÑÏú® Í≥†Ï†ï ÎπÑÎîîÏò§ Ïª®ÌÖåÏù¥ÎÑà -->
            <!-- ÎπÑÎîîÏò§ Ïª®ÌÖåÏù¥ÎÑà (Í∏∞Ï°¥ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ) -->
            <div class="relative" style="aspect-ratio: 9/16; height: 90vh; width: auto; max-width: 90vw;">
                <!-- ÎπÑÎîîÏò§: object-containÏúºÎ°ú ÎπÑÏú® ÎßûÏ∂îÍ≥†, max ÌÅ¨Í∏∞Î°ú Ï†úÌïú -->
                <video id="main-video"
                       th:src="@{${videoInfo.getVideoSrc()}}"
                       class="max-w-full max-h-full object-contain mx-auto my-auto absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"
                       autoplay loop playsinline>
                </video>

                <!-- Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ Ïû¨ÏÉù/Ï†ïÏßÄ -->
                <div id="video-overlay" class="absolute top-0 left-0 right-0 bottom-16 cursor-pointer z-10"></div>

                <!-- Ïª§Ïä§ÌÖÄ Ïû¨ÏÉù/ÏùºÏãúÏ†ïÏßÄ Î≤ÑÌäº -->
                <div class="absolute top-4 left-4 z-30">
                    <button id="play-pause-btn" class="bg-black bg-opacity-50 text-white p-3 rounded-full hover:bg-opacity-70 transition">
                        ‚ñ∂Ô∏è
                    </button>
                </div>

                <!-- Ïª§Ïä§ÌÖÄ ÌîÑÎ°úÍ∑∏ÎûòÏä§ Î∞î -->
                <div class="absolute bottom-0 left-0 w-full h-0.5 bg-gray-600 z-20 hover:h-1">
                    <div id="progress-bar" class="h-full bg-pink-500 transition-all duration-100 w-0"></div>
                </div>
            </div>

            <!-- Ïö∞Ï∏° Î≤ÑÌäº ÏòÅÏó≠ (Î∞òÏùëÌòï) -->
            <div class="absolute right-2 md:right-6 bottom-20 md:bottom-32 flex flex-col items-center space-y-4 md:space-y-6">
                <!-- Ï¢ãÏïÑÏöî Î≤ÑÌäº -->
                <div class="flex flex-col items-center group">
                    <button id="like-btn" class="bg-white bg-opacity-10 hover:bg-opacity-20 rounded-full p-2 md:p-3 transition-all duration-300 transform hover:scale-110">
                        <svg class="h-5 w-5 md:h-7 md:w-7 text-white transition-colors duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </button>
                    <span id="like-count" class="text-xs md:text-sm mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">Ï¢ãÏïÑÏöî</span>
                </div>

                <!-- ÎåìÍ∏Ä Î≤ÑÌäº -->
                <div class="flex flex-col items-center group">
                    <button id="comment-btn" class="bg-white bg-opacity-10 hover:bg-opacity-20 rounded-full p-2 md:p-3 transition-all duration-300 transform hover:scale-110">
                        <svg class="h-5 w-5 md:h-7 md:w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                        </svg>
                    </button>
                    <span class="text-xs md:text-sm mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">ÎåìÍ∏Ä</span>
                </div>

                <!-- Í≥µÏú† Î≤ÑÌäº -->
                <div class="flex flex-col items-center group">
                    <button id="share-btn" class="bg-white bg-opacity-10 hover:bg-opacity-20 rounded-full p-2 md:p-3 transition-all duration-300 transform hover:scale-110">
                        <svg class="h-5 w-5 md:h-7 md:w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
                        </svg>
                    </button>
                    <span class="text-xs md:text-sm mt-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">Í≥µÏú†</span>
                </div>
            </div>

            <!-- Ï¢åÏ∏° Ï†ïÎ≥¥ ÏòÅÏó≠ (Î∞òÏùëÌòï) -->
            <div class="absolute left-2 md:left-6 bottom-20 md:bottom-32 space-y-2 md:space-y-3 w-2/3 md:w-1/2">
                <!-- ÏóÖÎ°úÎçî Ï†ïÎ≥¥ -->
                <div class="flex items-center space-x-2 md:space-x-3">
                    <img th:src="@{${videoInfo.uploader.getProfileImgSrc()}}" alt="ÌîÑÎ°úÌïÑ" class="w-8 h-8 md:w-12 md:h-12 rounded-full object-cover border-2 border-white border-opacity-30">
                    <div class="flex flex-col">
                        <span class="text-sm md:text-lg font-semibold" th:text="${videoInfo.uploader.getUsername()}">ÏÇ¨Ïö©ÏûêÏù¥Î¶Ñ</span>
                        <span class="text-xs text-gray-300" th:text="'@' + ${videoInfo.uploader.getMention()}">@mention</span>
                    </div>
                    <!-- ÌåîÎ°úÏö∞ Î≤ÑÌäº (ÏûëÏùÄ ÌÅ¨Í∏∞) -->
                    <button class="bg-gradient-to-r from-pink-500 to-blue-500 hover:from-pink-600 hover:to-blue-600 text-white text-xs px-3 py-1 rounded-full font-medium transition-all duration-200 transform hover:scale-105">
                        ÌåîÎ°úÏö∞
                    </button>
                </div>

                <!-- ÏòÅÏÉÅ Ï†úÎ™© -->
                <div class="text-sm md:text-base font-medium text-white" th:text="${videoInfo.getVideoTitle()}">ÏòÅÏÉÅ Ï†úÎ™©</div>

                <!-- Ìï¥ÏãúÌÉúÍ∑∏ -->
                <div class="flex flex-wrap gap-1 md:gap-2">
                        <span th:each="tag : ${#arrays.toStringArray(videoInfo.getVideoTag().split(','))}"
                              th:text="${tag}"
                              class="text-xs bg-white bg-opacity-10 text-blue-300 px-2 py-1 rounded-full cursor-pointer hover:bg-opacity-20 transition-all duration-200">
                        </span>
                </div>

                <!-- ÏÑ§Î™Ö (Ï∂ïÏïΩÌòï) -->
                <div class="text-xs md:text-sm text-gray-300 line-clamp-2" th:text="${videoInfo.getVideoDescription()}">ÏòÅÏÉÅ ÏÑ§Î™Ö</div>
            </div>

            <!-- Ï°∞ÌöåÏàò (Î∞òÏùëÌòï) -->
            <div class="absolute bottom-4 md:bottom-6 right-2 md:right-6 text-xs md:text-sm text-gray-300 bg-black bg-opacity-50 px-2 py-1 rounded-full">
                <span th:text="'Ï°∞ÌöåÏàò ' + ${videoInfo.getVideoViews()} + 'Ìöå'">Ï°∞ÌöåÏàò 0Ìöå</span>
            </div>
        </div>
    </main>
</div>

<!-- ÎåìÍ∏Ä Î™®Îã¨ -->
<div id="comment-modal" class="fixed inset-0 z-50 hidden">
    <!-- Î™®Îã¨ Î∞∞Í≤Ω -->
    <div class="absolute inset-0 bg-black bg-opacity-75 backdrop-blur-sm" id="modal-backdrop"></div>

    <!-- Î™®Îã¨ Ïª®ÌÖêÏ∏† -->
    <div class="relative w-full h-full flex items-center justify-center p-4">
        <div class="bg-gray-900 rounded-2xl w-full max-w-2xl h-3/4 flex flex-col shadow-2xl">
            <!-- Î™®Îã¨ Ìó§Îçî -->
            <div class="flex items-center justify-between p-4 border-b border-gray-700">
                <h2 class="text-xl font-bold text-white">ÎåìÍ∏Ä</h2>
                <button id="close-modal" class="text-gray-400 hover:text-white transition-colors duration-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Ï†ïÎ†¨ Î≤ÑÌäº -->
            <div class="flex space-x-4 p-4 border-b border-gray-700">
                <button id="popular-sort" class="bg-gradient-to-r from-pink-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-200">
                    Ïù∏Í∏∞Ïàú
                </button>
                <button id="recent-sort" class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-200">
                    ÏµúÏã†Ïàú
                </button>
            </div>

            <!-- ÎåìÍ∏Ä Î™©Î°ù -->
            <div class="flex-1 overflow-y-auto p-4 space-y-4">
                <!-- ÏÉòÌîå ÎåìÍ∏ÄÎì§ -->
                <div class="flex space-x-3">
                    <img src="https://picsum.photos/32/32?random=1" alt="ÌîÑÎ°úÌïÑ" class="w-8 h-8 rounded-full">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="font-semibold text-sm text-white">ÏÇ¨Ïö©Ïûê1</span>
                            <span class="text-xs text-gray-400">2ÏãúÍ∞Ñ Ï†Ñ</span>
                        </div>
                        <p class="text-sm text-gray-300 mt-1">Ï†ïÎßê Ïû¨ÎØ∏ÏûàÎäî ÏòÅÏÉÅÏù¥ÎÑ§Ïöî! üëç</p>
                        <div class="flex items-center space-x-4 mt-2">
                            <button class="text-xs text-gray-400 hover:text-white flex items-center space-x-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                                <span>12</span>
                            </button>
                            <button class="text-xs text-gray-400 hover:text-white">ÎãµÍ∏Ä</button>
                        </div>
                    </div>
                </div>

                <div class="flex space-x-3">
                    <img src="https://picsum.photos/32/32?random=2" alt="ÌîÑÎ°úÌïÑ" class="w-8 h-8 rounded-full">
                    <div class="flex-1">
                        <div class="flex items-center space-x-2">
                            <span class="font-semibold text-sm text-white">ÏÇ¨Ïö©Ïûê2</span>
                            <span class="text-xs text-gray-400">5ÏãúÍ∞Ñ Ï†Ñ</span>
                        </div>
                        <p class="text-sm text-gray-300 mt-1">Ïù¥Îü∞ Ïª®ÌÖêÏ∏†Í∞Ä Îçî ÎßéÏïòÏúºÎ©¥ Ï¢ãÍ≤†Ïñ¥Ïöî ‚ú®</p>
                        <div class="flex items-center space-x-4 mt-2">
                            <button class="text-xs text-gray-400 hover:text-white flex items-center space-x-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                                <span>8</span>
                            </button>
                            <button class="text-xs text-gray-400 hover:text-white">ÎãµÍ∏Ä</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÎåìÍ∏Ä ÏûÖÎ†• -->
            <div class="p-4 border-t border-gray-700">
                <div class="flex space-x-3">
                    <img src="https://picsum.photos/32/32?random=me" alt="ÎÇ¥ ÌîÑÎ°úÌïÑ" class="w-8 h-8 rounded-full">
                    <div class="flex-1 flex space-x-2">
                        <input type="text" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." class="flex-1 bg-gray-800 text-white px-3 py-2 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button class="bg-gradient-to-r from-pink-500 to-blue-500 hover:from-pink-600 hover:to-blue-600 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 transform hover:scale-105">
                            Ï†ÑÏÜ°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Î™®Îã¨ Î∞è ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
<div th:replace="~{fragments/bottom-navbar.html :: bottom-navbar}"></div>
<div th:replace="~{fragments/sidebar.html :: loginModal}"></div>
<div th:replace="~{fragments/sidebar.html :: signupModal}"></div>

<script src="/js/user-session.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const video = document.getElementById('main-video');
        const videoOverlay = document.getElementById('video-overlay');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = progressBar.parentElement;

        // ÎåìÍ∏Ä Î™®Îã¨ Í¥ÄÎ†®
        const commentBtn = document.getElementById('comment-btn');
        const commentModal = document.getElementById('comment-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const closeModal = document.getElementById('close-modal');
        const popularSort = document.getElementById('popular-sort');
        const recentSort = document.getElementById('recent-sort');

        // Ïû¨ÏÉù/ÏùºÏãúÏ†ïÏßÄ Î≤ÑÌäº
        function updatePlayPauseIcon() {
            playPauseBtn.textContent = video.paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
        }

        playPauseBtn.addEventListener('click', () => {
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
            updatePlayPauseIcon();
        });

        video.addEventListener('play', updatePlayPauseIcon);
        video.addEventListener('pause', updatePlayPauseIcon);

        // Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ÎèÑ Ïû¨ÏÉù/Ï†ïÏßÄ
        videoOverlay.addEventListener('click', () => {
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
            updatePlayPauseIcon();
        });

        // ÌîÑÎ°úÍ∑∏ÎûòÏä§Î∞î ÏóÖÎç∞Ïù¥Ìä∏
        video.addEventListener('timeupdate', () => {
            const percent = (video.currentTime / video.duration) * 100;
            progressBar.style.width = percent + '%';
        });

        let isDragging = false;

        progressContainer.addEventListener('mousedown', (e) => {
            isDragging = true;
            updateProgress(e);
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                updateProgress(e);
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
            }
        });

        function updateProgress(e) {
            const rect = progressContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const ratio = Math.min(Math.max(x / rect.width, 0), 1);
            video.currentTime = ratio * video.duration;
            progressBar.style.width = `${ratio * 100}%`;
        }

        // Ï¥àÍ∏∞Ìôî
        updatePlayPauseIcon();
        console.log('Ïª§Ïä§ÌÖÄ ÏòÅÏÉÅ Ïª®Ìä∏Î°§ UI Ï†ÅÏö© ÏôÑÎ£å');

        // ÎåìÍ∏Ä Î™®Îã¨ Ïó¥Í∏∞
        commentBtn.addEventListener('click', () => {
            commentModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        });

        // ÎåìÍ∏Ä Î™®Îã¨ Îã´Í∏∞
        function closeCommentModal() {
            commentModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        closeModal.addEventListener('click', closeCommentModal);
        modalBackdrop.addEventListener('click', closeCommentModal);

        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !commentModal.classList.contains('hidden')) {
                closeCommentModal();
            }
        });

        // ÎåìÍ∏Ä Ï†ïÎ†¨ Î≤ÑÌäº
        popularSort.addEventListener('click', () => {
            popularSort.className = 'bg-gradient-to-r from-pink-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-200';
            recentSort.className = 'bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-200';
        });

        recentSort.addEventListener('click', () => {
            recentSort.className = 'bg-gradient-to-r from-pink-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-200';
            popularSort.className = 'bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-full text-sm font-medium transition-all duration-200';
        });

        // Ï¢ãÏïÑÏöî Î≤ÑÌäº Ïï†ÎãàÎ©îÏù¥ÏÖò
        const likeBtn = document.getElementById('like-btn');
        let isLiked = false;

        likeBtn.addEventListener('click', () => {
            if (!isLiked) {
                likeBtn.querySelector('svg').style.fill = '#ef4444';
                likeBtn.querySelector('svg').style.stroke = '#ef4444';
                likeBtn.classList.add('animate-pulse');
                setTimeout(() => likeBtn.classList.remove('animate-pulse'), 600);
                isLiked = true;
            } else {
                likeBtn.querySelector('svg').style.fill = 'none';
                likeBtn.querySelector('svg').style.stroke = 'currentColor';
                isLiked = false;
            }
        });

        // Ï¥àÍ∏∞Ìôî ÏôÑÎ£å
        console.log('Video UI initialized with native controls');
    });
</script>

</body>
</html>